{
    "version": "0.1",
    "greeting": {
        "text": "\nWelcome to the Vertiv Geist IMD Configuration Script!\n",
        "display": 1
    },
    "prompts": [
        {
            "config_item": "row",
            "config_item_name": "Rack Row",
            "prompt_text": "rack row",
            "example_text": "7",
            "verify_functions": [["is_int"]],
            "format_functions": [["zfill", 2]],
            "input_mode": "input",
            "unique_value": 1,
            "api_paths": [""],
            "empty_allowed": 0,
            "required": 1
        },
        {
            "config_item": "rack",
            "config_item_name": "Rack Number",
            "prompt_text": "rack number",
            "example_text": "5",
            "verify_functions": [["is_int"]],
            "format_functions": [["zfill", 2]],
            "input_mode": "input",
            "unique_value": 1,
            "api_paths": [""],
            "empty_allowed": 0,
            "required": 1
        },
        {
            "config_item": "pdu_letter",
            "config_item_name": "PDU Letter",
            "prompt_text": "PDU letter",
            "example_text": "b",
            "verify_functions": [["is_one_of", ["a", "b"]]],
            "format_functions": [[]],
            "input_mode": "input",
            "unique_value": 1,
            "api_paths": [""],
            "default_value": "a",
            "empty_allowed": 0,
            "required": 1
        },
        {
            "config_item": "imd_hostname",
            "config_item_name": "IMD Hostname",
            "prompt_text": "IMD hostname",
            "example_text": "ab-0123456-ps-b1",
            "verify_functions": [["is_hostname"]],
            "format_functions": [[]],
            "input_mode": "input",
            "unique_value": 1,
            "api_calls": [
                {
                    "method":   "post",
                    "api_path": "conf/system/",
                    "json":     {"label": "{imd_hostname}"}
                },
                {
                    "method":   "post",
                    "api_path": "conf/system/",
                    "json":     {"hostname": "{imd_hostname}"}
                }
            ],
            "api_paths": ["conf/system/"],
            "http_method": "post",
            "cmd": "set",
            "json": {"hostname": "{imd_hostname}"},
            "empty_allowed": 0,
            "required": 1
        },
        {
            "config_item": "primary_ntp",
            "config_item_name": "Primary NTP Server",
            "prompt_text": "primary NTP FQDN",
            "example_text": "time.primary.net",
            "verify_functions": [["is_domain_name"]],
            "format_functions": [[]],
            "input_mode": "input",
            "unique_value": 0,
            "encrypt_default": 1,
            "salt": "",
            "default_value": "",
            "api_paths": [""],
            "cmd": "set",
            "empty_allowed": 0,
            "required": 1
        },
        {
            "config_item": "secondary_ntp",
            "config_item_name": "Secondary NTP Server",
            "prompt_text": "the secondary NTP FQDN",
            "example_text": "time.secondary.net",
            "verify_functions": [["is_domain_name"]],
            "format_functions": [[]],
            "input_mode": "input",
            "unique_value": 0,
            "encrypt_default": 1,
            "salt": "",
            "default_value": "",
            "api_paths": [""],
            "cmd": "set",
            "empty_allowed": 0,
            "required": 1
        },
        {
            "config_item": "username",
            "config_item_name": "Username",
            "prompt_text": "username",
            "example_text": "hacker",
            "verify_functions": [["is_valid_username"]],
            "format_functions": [[]],
            "input_mode": "input",
            "unique_value": 0,
            "encrypt_default": 1,
            "salt": "",
            "default_value": "",
            "api_paths": ["auth/{username}"],
            "empty_allowed": 0,
            "required": 1
        },
        {
            "config_item": "password",
            "config_item_name": "Password",
            "prompt_text": "password",
            "example_text": "l337+C0d3r$",
            "verify_functions": [["is_between", 1, 300]],
            "format_functions": [[]],
            "input_mode": "getpass",
            "unique_value": 0,
            "encrypt_default": 1,
            "salt": "",
            "default_value": "",
            "api_paths": [""],
            "empty_allowed": 0,
            "required": 1
        }
    ],

    "formatters": [
        {
            "config-item": "location",
            "config-item-name": "Rack Location",
            "cmd": "set",
            "json": {"description": "{location}"},
            "format_functions": [[ "apply_string_template", "R{row}-{rack}/{pdu_letter}", ["row", "rack", "pdu_letter"]]],
            "api_calls": [
                {
                    "method":   "post",
                    "api_path": "conf/contact/",
                    "json":     {"description": "{formatted_output}"}
                }
            ]
        },
        {
            "config-item": "ntp",
            "config-item-name": "NTP Servers",
            "cmd": "set",
            "json": {"description": "{location}"},
            "format_functions": [[ "build_json", ["ntpServer1", "ntpServer2]"], ["primary_ntp", "secondary_ntp"]]],
            "api_calls": [
                {
                    "method":   "post",
                    "api_path": "conf/contact/",
                    "json":     {}
                }
            ]
        }
    ],

    "defaults": [
        {
            "config-item": "dns_1",
            "config-item-name": "DNS 1",
            "api_calls": [
                {
                    "method":   "post",
                    "api_path": "network/ethernet/dns/1",
                    "cmd":      "del"
                }
            ]
        },
        {
            "config-item": "dns_0",
            "config-item-name": "DNS 0",
            "api_calls": [
                {
                    "method":   "post",
                    "api_path": "network/ethernet/dns/0",
                    "cmd":      "del"
                }
            ]
        },
        {
            "config-item": "snmp",
            "config-item-name": "snmp",
            "api_calls": [
                {
                    "method":   "post",
                    "api_path": "snmp",
                    "cmd":      "set",
                    "data":     {"v1v2cEnabled": "false", "v3Enabled": "false"}
                }
            ]
        },
        {
            "config-item": "dhcp",
            "config-item-name": "DHCP",
            "api_calls": [
                {
                    "method":   "post",
                    "api_path": "conf/contact",
                    "cmd":      "set",
                    "data":     {"label": "Bridge 0", "dhcpOn": "true", "enabled": "true"}
                }
            ]
        },
        {
            "config-item": "static_ip",
            "config-item-name": "Static IP",
            "api_calls": [
                {
                    "method":   "post",
                    "api_path": "network/ethernet/address/0",
                    "cmd":      "del",
                    "data":     {"label": "Bridge 0", "dhcpOn": "true", "enabled": "true"}
                }
            ]
        }
    ]
}